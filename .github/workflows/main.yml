name: Census Data Exploration ML Project

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  build:
    runs-on: ubuntu-20.04

    steps:
      - name: Checkout repo
        uses: actions/checkout@v2

      - name: Setup Python 3.8
        uses: actions/setup-python@v2
        with:
          python-version: 3.8.12

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pytest flake8
          # if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
          pip install -r ./DevOps_Proj3_v1/requirements.txt

      - name: Configure AWS Credentials
        uses: aws-actions/configure-aws-credentials@v1
        with:
          aws-access-key-id: ASIAZYKPQJWLFOWZYSP3
          aws-secret-access-key: /LBfeaYcReEoJJhaI3P6fYw2MAAmc3Xq2fFLVeSb
          aws-session-token: IQoJb3JpZ2luX2VjEKT//////////wEaDmFwLXNvdXRoZWFzdC0yIkcwRQIhAKcdsNAZNYYnzRKVCqNxmHSKylhQtU8vXd3ybjfsKp4oAiBjUIOW4Vy+pr6NJXPEkLbEXk+yeD0SMqKzAtyoe9SBfyqeAwiO//////////8BEAAaDDY3MDcxODUxMjUzNCIMfbQCXTmIFdhDMuItKvIC0M9uVkCKwgHzNbA3QhfIicd/XGG4B/13YQ8ceiU6NsFKCZBBN+cp8fuFjeDVfpZ7Q9N0et03by08J54tzXwXilBHg8eII2jJesm9yGfGjI9SNSv2BJ7i8QdGb1U3IhUEInTgGXbOsnkCsQySkQz4X+CYbrKmVLYPowTAP9+v5hzchKCOG//3wNorSdVqt+ZFU+WDUKpZM7XAVw1vl//X8lo/DWwps6nIW5VfWkUzWWROZkZZ14xdWePlmCD1ia0poY90lkWOHJyp+l1MaCJMXF7xXnfWWqrvs461kAGPKRpT9XZWZkse714driLjDZiPFO9gSaaso1ujW1TED+6UwHUTCmBC3hP4EvbWejGz0z8tn5HvFikDbKFgoMtjyTD7gBjxvvjBLeSwRlBwfySqHfHotArf7291ymwhHSGENh9l6sDQLRIAb/qKJex85eB/WcIPl1l6b3NtGsg/uMh1F2Nw+FHUML8Xk8/zh3Tuvpv5szCAv7iUBjqmAcGo1yG3A6y9WxKf1n2loYbpZLDK08V8MzRLlNsCxEyMEnyz4UI6IbYbIiTLHDAZVKoTxZDtSnqS4aaZHfbPzWKn7wbUwn9PN3fZuqc1fGWk4K2njzvNJUP2il8vNMWzYkuOGgC+cGmwzkkN5JfdTwdKE91VmlOB1mej7jPL7bDbSMruWXuQmq3+Fwr/KESPxAzYjvU8mLNQ/JWs5L8ENG+tA0T/7vM=
          aws-region: ap-southeast-2
        
      - name: Setup DVC
        uses: iterative/setup-dvc@v1
      - name: Pull data from DVC
        run: dvc pull -r driveremote
        
      - name: Lint with flake8
        run: |
          # stop the build if there are Python syntax errors or undefined names
          flake8 . --count --select=E9,F63,F7,F82 --show-source --statistics
          # exit-zero treats all errors as warnings. The GitHub editor is 127 chars wide
          flake8 . --count --exit-zero --max-complexity=10 --max-line-length=127 --statistics
      - name: Test with pytest
        run: pytest
